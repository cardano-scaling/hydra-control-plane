use anyhow::{anyhow, Context};
use pallas::ledger::primitives::PlutusScript;

use crate::model::hydra::tx::input::InputWrapper;

const PRE_APPLIED_SCRIPT: &str = "592B7701010033332323232323232323232323232323232323232322222932323232553335734002226464646464646500132323232553335734002226464646464646464646464646464646466666666666646664664664444444444444445001010807C03A01B00C805C02A013008803C01A00B004801C00A00230013574202A60026AE8404CC0B08C8C8C8C954CCD5CD00088C004C084D5D08014C018D5D09ABA200208981EA48103505431003370E90000011AAB9E00235573A0026EA8004CC0B0004D5D08089191919192A999AB9A001113232800991919192A999AB9A0011180098129ABA10029981A1191919192A999AB9A0011180098151ABA100208992A999AB9A00111328019BAD35742009375A6AE840066EB4D5D09ABA20011ABA200311304849103505431003370E900100199B8748000008D55CF0011AAB9D00137540026AE84D5D1001044C109240103505431003370E90000011AAB9E00235573A0026EA8D5D08024C020D5D08014C8C8C8C954CCD5CD00088C00044C954CCD5CD00088C014DD71ABA100308992A999AB9A001118019ABA1004089822248103505431003370E900200219B874800800CCDC3A40000046AAE78008D55CE8009BAA357420033303075C6AE84D5D10008D5D10009ABA200211303C490103505431003370E90000011AAB9E00235573A0026EA8004DD69ABA100F30013574201C60046004EB4CC0A805CD5D080619980B00CBAD3574201664646464AA666AE6800444C8CA00264646464AA666AE68004460026600CEB4D5D08014C014D5D09ABA2002089820248103505431003370E90000011AAB9E00235573A0026EA8D5D08024C8C8C8C954CCD5CD00088C004CC019D69ABA100298029ABA13574400411304049103505431003370E90000011AAB9E00235573A0026EA8D5D09ABA20041191919192A999AB9A0011180108992A999AB9A00111800089820A4903505431003370E900100199B8748000008D55CF0011AAB9D00137540024464646464AA666AE68004460042264AA666AE6800446002600E6AE8400C2264AA666AE6800446008226084920103505431003370E900200219B874800800CCDC3A40000046AAE78008D55CE8009BAA00111303A49103505431003370E90000011AAB9E00235573A0026EA8D5D0805198153AE3574201266602C464646464AA666AE68004460066EB8D5D0801044C954CCD5CD00088C024C080D5D0801844C954CCD5CD00088C01CC080D5D0802044C954CCD5CD00088C004DD69ABA1005980F9ABA13574400A11325533357340022300B30213574200C113255333573400223005375A6AE8401E603E6AE84D5D1003844C10124103505431003370E900500399B8748020018CDC3A400C00A66E1D20040043370E900100199B8748000008D55CF0011AAB9D001375400204E6AE84020CC00809CD5D08039BAE3574200C66602C0306602C052464646464AA666AE68004460042264AA666AE68004460082264AA666AE680044600022607A92103505431003370E900200219B874800800CCDC3A40000046AAE78008D55CE8009BAA0013574200A6605402A6AE84010C004D5D080198009ABA135744006604EEB4C051D71ABA2001357440026AE88004D5D10009ABA2001357440026AE88004D5D10009ABA2001357440026AE88004D5D10009ABA20013574400422604C92103505431003370E90000011AAB9E00235573A0026EA8D5D0804CD5D0803CC8C8C8C954CCD5CD00088C00CDD71ABA100208992A999AB9A0011180498059ABA10039980C80C1ABA135744006113255333573400223007300B35742008113255333573400223001375A6AE8401660146AE84D5D1002844C954CCD5CD00088C02CC030D5D0803044C954CCD5CD00088C014DD69ABA100798051ABA13574400E11302B49103505431003370E900500399B8748020018CDC3A400C00A66E1D20040043370E900100199B8748000008D55CF0011AAB9D00137546AE84D5D100388C8C8C8C954CCD5CD00088994004DD69ABA100398051ABA1001991919192A999AB9A00111328049980F00F9ABA10039ABA10019980F3AE357426AE880046AE8800844C954CCD5CD00088C004CC07807CD5D0801CC8C8C8C954CCD5CD00088C004DD69ABA10029BAD357426AE8800822606092103505431003370E90000011AAB9E00235573A0026EA8D5D09ABA200308992A999AB9A001118059998068083AD357420093301F75C6AE84D5D1002044C954CCD5CD00088C01CCC080084D5D0802844C954CCD5CD0008899194034CC08C090D5D08044CC094050D5D08014CCC044051D69ABA1001C991919192A999AB9A001118009BAD35742005375A6AE84D5D1001044C0D5240103505431003370E90000011AAB9E00235573A0026EA8D5D09ABA2001911981080100086AE88004D5D100308992A999AB9A00111802998110119ABA1007991919192A999AB9A001113302675C6AE8400844C0D1240103505431003370E90000011AAB9E00235573A0026EA8D5D09ABA200708992A999AB9A00111801089818A4903505431003370E900600419B874802801CCDC3A401000C66E1D20060053370E900200219B874800800CCDC3A40000046AAE78008D55CE8009BAA357426AE880046AE8800844C099240103505431003370E90000011AAB9E00235573A0026EA800488C88C008DD58009811911999AAB9F0012800119400E002600C6AAE74006600A6AAE78005300435744006357420050002323232325533357340022300D3007357420053301675A6AE84D5D1001044C954CCD5CD00088C04CC020D5D0801CCC05DD69ABA13574400611325325333573400423003300A3574200B3001357426AE880142264AA666AE6800444CA01660186AE8401E60066AE840066EB4D5D09ABA20011ABA2006113255333573400223009300C3574200F375A6AE84D5D1003844C954CCD5CD00088C054C034D5D0804044C954CCD5CD00088C044C038D5D0804CDD69ABA135744012113255333573400223005375C6AE8402A6EB8D5D09ABA200A08992A999AB9A001118039BAE35742017375A6AE84D5D1005844C954CCD5CD00088C004C044D5D08064C044D5D09ABA200C08992A999AB9A0011180798091ABA100D089817A4903505431003370E900A00699B8748048030CDC3A402001666E1D200E00A3370E900600499B8748028020CDC3A401000E66E1D200600623232323255333573400223001375C6AE840082264A64A666AE680084600A60026AE840102264AA666AE68004460066EB8D5D0802CC008D5D09ABA2005089817248103505431003370E90020029191919192A999AB9A00111800980A1ABA100208992A999AB9A0011180108992A999AB9A00111802089819A48103505431003370E900200219B874800800CCDC3A40000046AAE78008D55CE8009BAA0013370E900100199B8748000008D55CF0011AAB9D001375400266E1D20040043370E900100199B8748000008D55CF0011AAB9D0013754002464646464AA666AE6800446002600C6AE840082264AA666AE6800446006600E6AE8400C2264AA666AE680044600A6EB8D5D0802044C09524103505431003370E900200219B874800800CCDC3A40000046AAE78008D55CE8009BAA00123232323255333573400223001375C6AE840082264AA666AE68004460066EB8D5D0801844C08D240103505431003370E900100199B8748000008D55CF0011AAB9D0013754002464646464AA666AE68004460026EB8D5D08014DD69ABA13574400411302149103505431003370E90000011AAB9E00235573A0026EA8004D5D100108980DA48103505431003370E90000011AAB9E00235573A0026EA8006445200322500C92C992C991919192A999AB9A0011180108992A999AB9A00111800089810A4903505431003370E900100199B8748000008D55CF0011AAB9D0013754009133014491034D303600593330122232333573400300080119B8F002001301300130159001911001A426603C44B200318004886400A44B264666AE6800600100233710002900044C01800E30020003180122B266028921034D303100323301E22590018C00A442B2B320192290049119199AB9A0018004008CDC780200111900C914802488C8CCD5CD000C00200466E1C00C0048C009180044C0100040013301D22590018C002443003900291001260080024C800C88800D2222222222222222010454CC8C8C8C8A4CC0652401034D30320032333573400300080119B8732593330182232333573400300080119B8F0020015006301B9007911001A4260040031480006466446446004002604A44B20031003910C801488CC020004C01800C90019100124006440028009119B80002001A4000337012B32A0072200245407642B26666660420024464A6464646464A666AE680184564CCCD55CF80394008A003001357420113574401040024320032259300500290AC9999AAB9F0022801140060026AE8400E6AE8800C800486400644B266016018005215933335573E00450022800C004D5D0801CD5D1001900090C800C8964C0CC00A42B26666AAE7C008A004464650010021ABA20043574200700090AC99999981B00091192A999AB9A001115933335573E00450022800C004D5D0801CD5D1001900090C800C8964C0EC00A42B26666AAE7C008A004464650010021ABA20043574200700090AC980C000C86003001003800918012300246004460041180119B8748000008A004500228011400A43001802805C01E00700122601C9322601A93226018931130094991300849889802A4C8980224C44C00526089800A4C464A64A666AE680084564CCCD55CF804940088C8CA002004357440166AE8402A001215933333302C001223255333573400222B26666AAE7C008A00450018009ABA10039ABA20032001219001912C981880148564CCCD55CF80114008A0030013574200735744006400243200322593301101200290AC9999AAB9F0022801140060026AE8400E6AE8800C800486400644B26026005215933335573E00450022800C004D5D0801CD5D1001900090C800C8964C06000A42B26666AAE7C008A004464650010021ABA20043574200700090AC981F800C8600300100F805C01E00700123002460048C0088C009180111801230022300246004460041180119B8748000008A004500228011400A4300180380091300249913001498226002931192992999AB9A002115933335573E0165002232328008010D5D10069ABA100C80048564CCCCCC0B800488C954CCD5CD00088AC9999AAB9F0022801140060026AE8400E6AE8800C800486400644B26066005215933335573E00450022800C004D5D0801CD5D1001900090C800C8964CC04C05000A42B26666AAE7C008A00450018009ABA10039ABA20032001219001912C980A80148564CCCD55CF80114008A003001357420073574400640024320032259301A00290AC9999AAB9F0022801140060026AE8400E6AE8800C800486400644B2603C005215933335573E00450022800C004D5D0801CD5D1001900090C800C8964C11C00A42B26666AAE7C008A00450018009ABA10039ABA20032001219001912C982580148564CCCD55CF80114008A0030013574200735744006400243200322593302B04F00290AC9999AAB9F00228011191940040086AE88010D5D0801C00242B2605800321800C00407E037017809C03E017007801C0048C0091801230022300246004460048C0088C009180111801230022300246004460048C0088C00918011180104600466E1D2000002280114008A004500290C00600200244C0092644C00526089800A4C464AA666AE680044600300208C008CDC3A400C01866E1D200400A3370E9001004119999981400091192A999AB9A001115933335573E0045002232328008010D5D10021ABA100380048564C01800643001001460048C008230023370E900000114008A004500228011199999813800914008A004500228008008A004464466666605000245002280100114008A0046050446666AAE7C004A00300012C98021ABA100290AC98021ABA200390C0060060050012300244CA00460066AE88009000259302400190C00400518010CDC3A40000045002280114008A005215900190A80FC5407A44443001002800CCC0204488C88C008004C0A889640062007221330060023004001001A42A03E89811249034D30390048540792220012400513232593301B4901034D3033003302422590018C00A4432005223255333573400222603E00422600E00866E3C008020900191000A264B2B266038921034D30340032333573400300080119B8795990029100122A04121593333330240012232532323232325333573400C22B26666AAE7C01CA00450018009ABA10089ABA20082001219001912C980280148564CCCD55CF80114008A0030013574200735744006400243200322593300B00C00290AC9999AAB9F0022801140060026AE8400E6AE8800C800486400644B2606C005215933335573E0045002232328008010D5D10021ABA100380048564CCCCCC0E400488C954CCD5CD00088AC9999AAB9F0022801140060026AE8400E6AE8800C800486400644B2607C005215933335573E0045002232328008010D5D10021ABA100380048564C06000643001800801C0048C0091801230022300208C008CDC3A40000045002280114008A00521800C01402E00F00380091300E4991300D4991300C49889804A4C8980424C44C0152644C0112622600293044C005262325325333573400422B26666AAE7C024A004464650010021ABA200B3574201500090AC99999981780091192A999AB9A001115933335573E00450022800C004D5D0801CD5D1001900090C800C8964C0D000A42B26666AAE7C008A00450018009ABA10039ABA20032001219001912C9980880900148564CCCD55CF80114008A003001357420073574400640024320032259301300290AC9999AAB9F0022801140060026AE8400E6AE8800C800486400644B26030005215933335573E0045002232328008010D5D10021ABA100380048564C10800643001800807C02E00F003800918012300246004460048C0088C009180111801230022300208C008CDC3A40000045002280114008A00521800C01C0048980124C89800A4C1130014988C94C94CCD5CD00108AC9999AAB9F00B28011191940040086AE88034D5D0806400242B26666660620024464AA666AE680044564CCCD55CF80114008A003001357420073574400640024320032259303600290AC9999AAB9F0022801140060026AE8400E6AE8800C800486400644B266026028005215933335573E00450022800C004D5D0801CD5D1001900090C800C8964C05400A42B26666AAE7C008A00450018009ABA10039ABA20032001219001912C980D00148564CCCD55CF80114008A003001357420073574400640024320032259301E00290AC9999AAB9F0022801140060026AE8400E6AE8800C800486400644B26094005215933335573E00450022800C004D5D0801CD5D1001900090C800C8964C13800A42B26666AAE7C008A00450018009ABA10039ABA20032001219001912C9981582900148564CCCD55CF801140088C8CA002004357440086AE8400E0012159302C00190C00600203F01B80BC04E01F00B803C00E002460048C009180111801230022300246004460048C0088C009180111801230022300246004460048C0088C008230023370E900000114008A004500228014860030010012260049322600293044C005262325533357340022300180104600466E1D200600C3370E900200519B87480080208CCCCCC0AC00488C954CCD5CD00088AC9999AAB9F00228011191940040086AE88010D5D0801C00242B2600C00321800800A3002460041180119B8748000008A00450022801140088CCCCCC0A80048A00450022801140040045002232233333302B0012280114008008A0045002302B2233335573E00250018000964C010D5D080148564C010D5D1001C8600300300280091801226500230033574400480012C9813800C860020028C00866E1D2000002280114008A004500290AC800C85408A2A0432222180080140066601622446446004002605A44B20031003910998030011802000800D21502244C095241034D303900485408522200119802889119118010009813912C800C400E4426600C00460080023302522590018C002443003900291000A60080021800C804C88800D13302125933301B2232333573400300080119B8F00200100400190AC800C4C0992401034D303800910C8014896400E2B264666AE680060010023370E0029001460011302A4901034D3038004884C0B12401034D3038001130254901034D30370019812912C800C6001221801C80148800530040010C00640264440068C009159330212590018A80FC8564C090006426603E9201034D31320032333573400300080119B8F001006898132481034D31320048540806604A44B2003180048860072005220024C01000430019009911001A2646603A9201034D3035005932333573400300080119B8F90019110018012264B320032290139119199AB9A0018004008CDC7802001119001914809C88C8CCD5CD000C00200466E1C00C0048C0092003222002460045990029100122A04121593333330240012232532323232325333573400C22B26666AAE7C01CA00450018009ABA10089ABA20082001219001912C980280148564CCCD55CF80114008A0030013574200735744006400243200322593300B00C00290AC9999AAB9F0022801140060026AE8400E6AE8800C800486400644B2606C005215933335573E0045002232328008010D5D10021ABA100380048564CCCCCC0E400488C954CCD5CD00088AC9999AAB9F0022801140060026AE8400E6AE8800C800486400644B2607C005215933335573E0045002232328008010D5D10021ABA100380048564C06000643001800801C0048C0091801230022300208C008CDC3A40000045002280114008A00521800C01402E00F00380091300E4991300D4991300C49889804A4C8980424C44C0152644C0112622600293044C005262325325333573400422B26666AAE7C024A004464650010021ABA200B3574201500090AC99999981780091192A999AB9A001115933335573E00450022800C004D5D0801CD5D1001900090C800C8964C0D000A42B26666AAE7C008A00450018009ABA10039ABA20032001219001912C9980880900148564CCCD55CF80114008A003001357420073574400640024320032259301300290AC9999AAB9F0022801140060026AE8400E6AE8800C800486400644B26030005215933335573E0045002232328008010D5D10021ABA100380048564C10800643001800807C02E00F003800918012300246004460048C0088C009180111801230022300208C008CDC3A40000045002280114008A00521800C01C0048980124C89800A4C1130014988C94C94CCD5CD00108AC9999AAB9F00B28011191940040086AE88034D5D0806400242B26666660620024464AA666AE680044564CCCD55CF80114008A003001357420073574400640024320032259303600290AC9999AAB9F0022801140060026AE8400E6AE8800C800486400644B266026028005215933335573E00450022800C004D5D0801CD5D1001900090C800C8964C05400A42B26666AAE7C008A00450018009ABA10039ABA20032001219001912C980D00148564CCCD55CF80114008A003001357420073574400640024320032259301E00290AC9999AAB9F0022801140060026AE8400E6AE8800C800486400644B26094005215933335573E00450022800C004D5D0801CD5D1001900090C800C8964C13800A42B26666AAE7C008A00450018009ABA10039ABA20032001219001912C9981582900148564CCCD55CF801140088C8CA002004357440086AE8400E0012159302C00190C00600203F01B80BC04E01F00B803C00E002460048C009180111801230022300246004460048C0088C009180111801230022300246004460048C0088C008230023370E900000114008A004500228014860030010012260049322600293044C005262325533357340022300180104600466E1D200600C3370E900200519B87480080208CCCCCC0AC00488C954CCD5CD00088AC9999AAB9F00228011191940040086AE88010D5D0801C00242B2600C00321800800A3002460041180119B8748000008A00450022801140088CCCCCC0A80048A00450022801140040045002232233333302B0012280114008008A0045002302B2233335573E00250018000964C010D5D080148564C010D5D1001C8600300300280091801226500230033574400480012C9813800C860020028C00866E1D2000002280114008A004500290AC800C85408A2A0432222180080140066601622446446004002605A44B20031003910998030011802000800D21502244C0952401034D30390048540851801230021803008460045004500580088CD5400488CDC0000A400490000AC998008054801C88800D1301E491034D313100910AC800C400A44260449201034D313100088CC08089640063000910992CC801C888A4012452005280148C954CCD5CD00088C00600200D00704600466E3C0040384860060030024400460080029001911111111111111100704C04C00460051801064646464AA666AE6800444C8C8C8C8C8C8CA00264646464AA666AE6800444C8C8C8C8C8C8C8C8C8C8C8C8C8C8C8C8CCCCCCCCCCCC8CCC8CC8CC888888888888888A00202100F807403601900B80540260110078034016009003801400460026AE84054C004D5D080998181191919192A999AB9A0011180098109ABA100298031ABA13574400411304149103505431003370E90000011AAB9E00235573A0026EA8004CC0C0004D5D08089191919192A999AB9A001113232800991919192A999AB9A0011180098129ABA10029981C1191919192A999AB9A0011180098151ABA100208992A999AB9A00111328019BAD35742009375A6AE840066EB4D5D09ABA20011ABA200311304C49103505431003370E900100199B8748000008D55CF0011AAB9D00137540026AE84D5D1001044C119240103505431003370E90000011AAB9E00235573A0026EA8D5D08024C020D5D08014C8C8C8C954CCD5CD00088C00044C954CCD5CD00088C014DD71ABA100308992A999AB9A001118019ABA1004089824248103505431003370E900200219B874800800CCDC3A40000046AAE78008D55CE8009BAA357420033303475C6AE84D5D10008D5D10009ABA2002113040490103505431003370E90000011AAB9E00235573A0026EA8004DD69ABA100F30013574201C60046004EB4CC0B805CD5D080619980B00CBAD3574201664646464AA666AE6800444C8CA00264646464AA666AE68004460026600CEB4D5D08014C014D5D09ABA2002089822248103505431003370E90000011AAB9E00235573A0026EA8D5D08024C8C8C8C954CCD5CD00088C004CC019D69ABA100298029ABA13574400411304449103505431003370E90000011AAB9E00235573A0026EA8D5D09ABA20041191919192A999AB9A0011180108992A999AB9A00111800089822A4903505431003370E900100199B8748000008D55CF0011AAB9D00137540024464646464AA666AE68004460042264AA666AE6800446002600E6AE8400C2264AA666AE680044600822608C920103505431003370E900200219B874800800CCDC3A40000046AAE78008D55CE8009BAA00111303E49103505431003370E90000011AAB9E00235573A0026EA8D5D0805198173AE3574201266602C464646464AA666AE68004460066EB8D5D0801044C954CCD5CD00088C024C080D5D0801844C954CCD5CD00088C01CC080D5D0802044C954CCD5CD00088C004DD69ABA1005980F9ABA13574400A11325533357340022300B30213574200C113255333573400223005375A6AE8401E603E6AE84D5D1003844C11124103505431003370E900500399B8748020018CDC3A400C00A66E1D20040043370E900100199B8748000008D55CF0011AAB9D00137540020566AE84020CC0080ACD5D08039BAE3574200C66602C0306602C05A464646464AA666AE68004460042264AA666AE68004460082264AA666AE680044600022608292103505431003370E900200219B874800800CCDC3A40000046AAE78008D55CE8009BAA0013574200A6605C02A6AE84010C004D5D080198009ABA1357440066056EB4C051D71ABA2001357440026AE88004D5D10009ABA2001357440026AE88004D5D10009ABA2001357440026AE88004D5D10009ABA20013574400422605492103505431003370E90000011AAB9E00235573A0026EA8D5D0804CD5D0803CC8C8C8C954CCD5CD00088C00CDD71ABA100208992A999AB9A0011180498059ABA10039980E80E1ABA135744006113255333573400223007300B35742008113255333573400223001375A6AE8401660146AE84D5D1002844C954CCD5CD00088C02CC030D5D0803044C954CCD5CD00088C014DD69ABA100798051ABA13574400E11302F49103505431003370E900500399B8748020018CDC3A400C00A66E1D20040043370E900100199B8748000008D55CF0011AAB9D00137546AE84D5D100388C8C8C8C954CCD5CD00088994004DD69ABA100398051ABA1001991919192A999AB9A0011132804998110119ABA10039ABA1001998113AE357426AE880046AE8800844C954CCD5CD00088C004CC08808CD5D0801CC8C8C8C954CCD5CD00088C004DD69ABA10029BAD357426AE8800822606892103505431003370E90000011AAB9E00235573A0026EA8D5D09ABA200308992A999AB9A001118059998068083AD357420093302375C6AE84D5D1002044C954CCD5CD00088C01CCC090094D5D0802844C954CCD5CD0008899194034CC09C0A0D5D08044CC0A4050D5D08014CCC044051D69ABA1001C991919192A999AB9A001118009BAD35742005375A6AE84D5D1001044C0E5240103505431003370E90000011AAB9E00235573A0026EA8D5D09ABA2001911981280100086AE88004D5D100308992A999AB9A00111802998130139ABA1007991919192A999AB9A001113302A75C6AE8400844C0E1240103505431003370E90000011AAB9E00235573A0026EA8D5D09ABA200708992A999AB9A0011180108981AA4903505431003370E900600419B874802801CCDC3A401000C66E1D20060053370E900200219B874800800CCDC3A40000046AAE78008D55CE8009BAA357426AE880046AE8800844C0A9240103505431003370E90000011AAB9E00235573A0026EA800488C88C008DD58009813911999AAB9F0012800119400E002600C6AAE74006600A6AAE78005300435744006357420050002323232325533357340022300D3007357420053301A75A6AE84D5D1001044C954CCD5CD00088C04CC020D5D0801CCC06DD69ABA13574400611325325333573400423003300A3574200B3001357426AE880142264AA666AE6800444CA01660186AE8401E60066AE840066EB4D5D09ABA20011ABA2006113255333573400223009300C3574200F375A6AE84D5D1003844C954CCD5CD00088C054C034D5D0804044C954CCD5CD00088C044C038D5D0804CDD69ABA135744012113255333573400223005375C6AE8402A6EB8D5D09ABA200A08992A999AB9A001118039BAE35742017375A6AE84D5D1005844C954CCD5CD00088C004C044D5D08064C044D5D09ABA200C08992A999AB9A0011180798091ABA100D089819A4903505431003370E900A00699B8748048030CDC3A402001666E1D200E00A3370E900600499B8748028020CDC3A401000E66E1D200600623232323255333573400223001375C6AE840082264A64A666AE680084600A60026AE840102264AA666AE68004460066EB8D5D0802CC008D5D09ABA2005089819248103505431003370E90020029191919192A999AB9A00111800980A1ABA100208992A999AB9A0011180108992A999AB9A0011180208981BA48103505431003370E900200219B874800800CCDC3A40000046AAE78008D55CE8009BAA0013370E900100199B8748000008D55CF0011AAB9D001375400266E1D20040043370E900100199B8748000008D55CF0011AAB9D0013754002464646464AA666AE6800446002600C6AE840082264AA666AE6800446006600E6AE8400C2264AA666AE680044600A6EB8D5D0802044C0A524103505431003370E900200219B874800800CCDC3A40000046AAE78008D55CE8009BAA00123232323255333573400223001375C6AE840082264AA666AE68004460066EB8D5D0801844C09D240103505431003370E900100199B8748000008D55CF0011AAB9D0013754002464646464AA666AE68004460026EB8D5D08014DD69ABA13574400411302549103505431003370E90000011AAB9E00235573A0026EA8004D5D100108980FA48103505431003370E90000011AAB9E00235573A0026EA801629345402D22500C92805C8940324A0161809911192A999AB9A001113016490103505433001132553335734002226600A66E05200000433702900000188994004CDC2002800CCDC20020008CC01801000CCDC40012400066E1C005200030122223255333573400222006226600800466E1800C008CDC3800A400026020920103505435002001223232323255333573400223002113255333573400223001300735742006113015490103505431003370E900000199B8748008008D55CF0011AAB9D0013754002464646464AA666AE68004460026EB8D5D08014DD69ABA13574400411301249103505431003370E90000011AAB9E00235573A0026EA80048C88C008DD60009807111999AAB9F00128001400CC010D5D08014C00CD5D10012000601844B200318014886400A4464AA666AE6800444C8CCD5CD000C00200466E1C00920021130070043371E0049110B487964726148656164563100088C88C008004C03489640063002910C80148964CC02000801E300100144C01800C14800C888CA400A44A0072001912801C9400A44A00725002099319AB9C491024C6800800089640063000899AB9C0028010A40064444444444444444018130064901034D31320013005491034D30390013004491034D31300023223002001300522590018C002442B2600A005130040018C00823333330020012280114008A004500228008008888888CCCCCCD5D2003119198039AAB9D00135573C0026EA801C8C014DD5803918021BAC00723003375A00E460046EB801E000464C66AE7000600046460020024600446600400400291011C00A6DDBC130AB92F5B7CB8D1CCD8D79ECA5BFE25F6843C07B62841F00048811C8FC2A74DF32D01D1DB56B3ACB561831EF9C9970123079423ABFCB86E0033335122002228008014004425200500124520";

pub fn make_head_token_script(input: &InputWrapper) -> anyhow::Result<PlutusScript<2>> {
    let applied_script = PRE_APPLIED_SCRIPT.to_string()
        + hex::encode(input.inner.tx_hash.0).as_str()
        + match input.inner.txo_index {
            0 => Ok("00480001"),
            1 => Ok("00480081"),
            2 => Ok("00480101"),
            3 => Ok("00480181"),
            4 => Ok("00480201"),
            5 => Ok("00480281"),
            _ => Err(anyhow!("invalid txo_index")),
        }?;

    let script_bytes = hex::decode(applied_script).context("failed to decode script")?;
    Ok(PlutusScript(script_bytes.into()))

    // let script_bytes: Vec<u8> = HydraValidator::MHead.into();
    // let parameters = PlutusData::Array(vec![input.into()]);
    // let mut parameter_bytes: Vec<u8> = Vec::new();
    // encode(&parameters, &mut parameter_bytes).context("failed to encode parameters")?;

    // let script_bytes = apply_params_to_script(parameter_bytes.as_slice(), script_bytes.as_slice())
    //     .map_err(|e| anyhow!("Failed to apply params to script: {}", e))?;

    // Ok(PlutusV2Script(script_bytes.into()))
}
